package io.codeforall.javatars;

import org.academiadecodigo.bootcamp.Prompt;
import org.academiadecodigo.bootcamp.scanners.menu.MenuInputScanner;
import org.academiadecodigo.bootcamp.scanners.string.StringInputScanner;

import java.io.*;
import java.net.Socket;

public class Player implements Runnable {

    private Socket socket;
    private Engine engine;
    private Question question;
    private String team = null;
    private String player = null;
    public Player(Socket socket, Engine engine) {
        this.socket = socket;
        this.engine = engine;
    }

    @Override
    public void run() {
        try {
            Prompt prompt = new Prompt(socket.getInputStream(), new PrintStream(socket.getOutputStream()));
            PrintWriter out = new PrintWriter(socket.getOutputStream(), true);

            StringInputScanner stringInputScanner = new StringInputScanner();
            stringInputScanner.setMessage("""
                                            \s
                              =%%+=         \s
                           +%.  %  .%+      \s
                          % +%=   =%+ %     \s
                         # % +%%%%%+ % #    \s
                        #-=:% .%%+. %: -#   \s
                       % -% +%     %+.%= %  \s
                      * %-.%         %.-% * \s
                      %* %*   %%%%%   *% *% \s
                       %# #  %%%%%%%  # #%  \s
                     # :%=  %%%%+%%%%  =%: #\s
                     %. %%  %%%   %%%  %% .%\s
                     %-%+% :%%%* *%%%: %+%-%\s
                     %: .%  %%%% %%%%  %# :%\s
                     % .%#  %%%= =%%%  #%. %\s
                     . %# + =%%%%%%%= + #% .\s
                      #% *%  =%%%%%=  %* %# \s
                      % ## %   :+:   % ## % \s
                       %+ % %-     -% % +%  \s
                       . % %= %%%%% =% %..  \s
                        *.* %%%-%:%% **.*   \s
                         :# %#     #% #:    \s
                           %*  =+=  *%      \s
                             -%%%%%-        \s
                                            \s
                    """ +
                    "\n\n_____WELCOME_____\n\nWhat's your team name?\n");

            team = prompt.getUserInput(stringInputScanner);

            /*out.println("TEAM " + team);*/

            StringInputScanner stringInputScanner1 = new StringInputScanner();
            stringInputScanner1.setMessage("\nNow choose your player name!\n");

            player = prompt.getUserInput(stringInputScanner1);

            out.println("\nAmazing!!\n\nYou are prepare to play!\n\n" + player + " from " + team + "\n\nRules: \n - All the answers must be written in lower case\n - You have 3 HELPS, in order to access them just write 'h'\n\nGood luck!!\n");

            question = new Question(socket);


            question.question1();
            engine.broadcast("\n" + player + " from " + team + " pass the 1 question\n", this);

            question.question2();
            engine.broadcast("\n" + player + " from " + team + " pass the 2 question\n", this);

            question.question3();
            engine.broadcast("\n" + player + " from " + team + " pass the 3 question\n", this);

            question.question4();
            engine.broadcast("\n" + player + " from " + team + " pass the 4 question\n", this);

            question.question5();
            engine.broadcast("\n" + player + " from " + team + " pass the 5 question and can now enter a new room\n", this);



            ////////////////////////////////ENTERING GOLLUM ROOM///////////////////////////////

            String[] options = {"Yes", "No"};
            MenuInputScanner menu = new MenuInputScanner(options);
            menu.setMessage("\nWell done you pass all the challenges of the first room\nDo you want to continue?\n");

            String answer = options[prompt.getUserInput(menu) - 1];

            if (answer.equals("No")) {
                engine.broadcast("\n" + player + " from " + team + " has left the game\n", this);
                out.close();
                socket.close();
            }

            Question.counter = 3;

            StringInputScanner stringInputScannerGollum = new StringInputScanner();

            stringInputScannerGollum.setMessage(
                    "@@@@@@@%@%@%%%%%@@@%%@%%%@@@@@%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@@@@@@@@@@@@\n" +
                    "@@%@@@@%%@%%%%%%%@%%%%%%%%@@%%##********##%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@@@@@@@@\n" +
                    "@@@@@@@%%%%%%%%%%@@%@@%@%*+==--------::::.:=*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@@@@@@@\n" +
                    "@@@%@@%%%%%@@#%%%%%%%*+++++++==----::::----::=*##%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@@@@@\n" +
                    "@@@%@@%%@%%%%%%%%%%*==+++*****+++++=++---::::..:=**##%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%@@@@@\n" +
                    "@@@@%%%%%%%%%%%#*+====++*++**++++*+++=--:....::..-*###%%%%%%%%%%%%%%%%#%##%%%%%%%%%%%%@@@@\n" +
                    "%%%%%%%%%%%%@@#*==--===+++######**+**+==---::..... -**######################%%#%###%%%%@@@\n" +
                    "%%%%%%%%%%%%%#=--:--===++**#%%%%##*++++++--=-::.... :*##########################*#%%%%%%%%\n" +
                    "%%%%@%%%%%%%*-:::--===++**##%###%%%**=++====---::::...+#############################%%%%%#\n" +
                    "@%%@@%%%#%%#:-::::=+++++***####%%%#***+**+==--:-::::..:+######################*######%%%##\n" +
                    "@%%@%#%###*=:..::--=++=+**#%%%%%%##***#**+++==--=:----::###*#############*##***#########*#\n" +
                    "@@%%##%#%%*:...::-===++***#%%%#%%#*+****+*++=+:=+==---=:=##**####*###***********###******#\n" +
                    "%%@%%##%%*=...::--===+**##%%%%%%%%#*+++#**+==-=--==--:---**++=-:-#******************++***#\n" +
                    "%%%@@@%@%*-...::---=++**##%%%%%%%%#*++*###*-=-:-=-++---:*##%#+-:.#*****+++***++++++++++***\n" +
                    "@%@@%%@@#+....::-===++**#*#%%%%%%%%########*==:::=+=:=*%%%%%%%*: *****+++++++===+==++++***\n" +
                    "%%%@@%%%*+ ..::::-==+=*+*####%%%%%%%#*=+**#*+-::.-+*%%%%%%%%%%%* ***+++++**+=+++++++++++++\n" +
                    "%#@@@@%%#+ .::::----==+++*#**#%%%%%%##*+--=#+=-::-#%%##%%%#**%#=.*+++++++++==+++++++++++++\n" +
                    "%%@@@@%%#+...:::-==:=+=-+***#%%%%%%%##*++-.==+--=***%%###%*++#*.-*+++++++=========++++====\n" +
                    "@@@@@@%%%:....:::-+--*--++*#####%%%%%#**=*=-=+=:=+***#%%%*#*##-.+++++=++===+===--=+===--=-\n" +
                    "@@@@%@@%# .:::.::-*+:*=-++*#*##%%%%%%%%%#==--+-::==+*#+%#####+--+++++========----====---::\n" +
                    "%%@@@@%%*.:::--::-=#-+*:**+###%%%%%%@%%###*===-::.--*#*#**+*+=+==++==++====-=::::-------:.\n" +
                    "%%%%%%###.:-=====+-=+=#=+%#**%%%*=--*#@@%###++-::..:**+**-::-:+=--+=====+=----:::---:--...\n" +
                    "%%%%%%#%%=++:..**##*+--+#%%##@@#+=-=%#%%##%***+--:..+-::+=:..::+:-==-::---====-:--:::::...\n" +
                    "%%#%%##%%#-+=--*#@@@@* -#%%@@@#=+*#%%%%%%#*+-===-::--:..=*+-:::+=-:-==-::.:------:--::....\n" +
                    "###%%#%%%%+:=+*##%%#*-.-#%%@@@@#***#%%%%#**==-:::---:-: :#***++**+=-:-===--::::::::::.....\n" +
                    "%##%###%%%#..:-=+++==:.-#%%@@%%%%##**###**++==--=--::==..+#%%%###**+====+======--:........\n" +
                    "%%#######%##:.::=+##*:-=*#%@@@@@@%%####*+++++===+===-#*=:-#%%%%%%%#*++**++====---::::.....\n" +
                    "######*###*%%+::=*%+::-+*##@@@@%%@%%%%#**++**=-===*#%%%%#+%@@%%%%%%##*++++++**+++-:..::-..\n" +
                    "%%#*##**#*#%%##+-*+:..:+#%%%%%%%%#####%#*+++==--*%%%%%%%%%@@@%%%%%%%#####**+******+=-:::=:\n" +
                    "#########**#%##%#*-...::-+*######****###*++=-::*%%%%%%%%%%%%%%#%%%@%%%%%%%###******++=--=+\n" +
                    "#%%#*##%%##+*##%###=...:-=++*#####%%%%##+++=-=%@%%%%%%%%%%%%#*#%%%%%%%%%%%%####*****++++++\n" +
                    "#%###%*##%#*###*##*#*:=**#%#%%%%#%####**++*=+%@@@%%%%%#%%%%##+*%%%%%%%%%%%%########++****+\n" +
                    "##%#%%#*%%#*###***+*##=-+###%%%%%##*###*+**#@%%%%%%%%%###%%####%%%%%%%%%%%%%#######**+++**\n" +
                    "%#%#%%##%#*#######****#+:=+++##%%######*+=+#%%@%%%@@%%%#%%%%%###%%%%%%%%%%%%#########*+++*\n" +
                    "@%@%%%%%%%%%%%#%########*-.:-+########*+=-+++##%%@@%%%%%%%%%%+=*#%%%%%%%%%%%######%%%##*++\n" +
                    "%@%%%%%%@%%%%%#*%#%%%*+%#*#++##*###*#*++--+*##**##%%%%%%%%###-:-+*#%%%%%%%%%%####%@@%%%%#*\n" +
                    "@@@@@%##%@%%%%*%%%%%%%####%#*#%#%%###+*=--+#%%######%%@@@%###-:-=*##%%%%%%%%%#**%@@@@%%%%%\n" +
                    "@@@@@@@@@%@%%%%%%%%%%%%%%%%#%####%#%+-=*-=*#%%######%%%@@%#*#-.-+*##%%%%%%%%#*++@@@@@@@@%%\n" +
                    "@@@@%@@@@@#%%@%%%%%%%%%%%%%#%%%%#%%#+==#+*#%%%#*####*+#%%%###::-+##%%%%%%%%#*+=*@@@@@@@@%%\n" +
                    "@@@@@@@@@@%@%#%%%%%%%%%%%%%%%#%%#%%#+++###%##%%*******#%%%%%%::-*#%%%%%%%##*+-:#@@@@@@@@@@\n" +
                    "@@@@@@@@@@@@@%%@%%%%%%%%%%%%%%#*##%%*=*#%%%%##%%%###%%%%%%%%#::=##%%%%%####*+-:#@@@@@@@@@@\n" +
                    "@@@@@@@@@@@@%%#%@%%%%%%%%%%%%%%%#%%%%+*#%%%%%%%%%%%%%%%%%%%%=-=*##%%%%###**++=:#@@@@@@@@@@\n" +
                    "@@@%@@%@@@@@@%%%%%%%%%%%%%%%%%%%#%%%%#*#%%%%%%%%@@@@@@%%%%%#=+**###%%#####*++=:%@@@@@@@@@@\n" +
                    "@@@%@@%@@@@@@%@@@@@%%%%%%%%@%%%#%%%%%####%%%%%%%@@@@@@@@@@@*+####%%#######**==:@@@@@@@@@@@\n" +
                    "@@@@@@@@@@@@@@@@@@@@%%%@@%@@@@%**#%%@%%##%%%@%%@@@@@@@@@@@@+*%%%%%#######**+=-=@@@@@@@@@@@\n" +
                    "@@@@@@@@@@@@@@%@@@@@@@@@@@@@@@@@%#+#%@%%#%@%%@@@@@@@@@@@@@@+#%@@%%%####****++-+@@@@@@@@@@@\n" +
                    "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*%@@%%#%@@@@@@@@@@@@@@@%*%%%%@%%%##*#****+-#@@@@@@@@@@@\n" +
                    "@%%@@@@%%%%@@@@@@@@@@@@@@@@@@@@@@@@%*%@@@%%%@@@@@@@@@@@@@@##%@%%%%%%#######**=@@@@@@@@@@@@\n" +
                    "@@@@@@@@@@@@@@@@@@@@@@@%@%%@%%%%%%@@%%%@@@%%%@@@@@@@@@@@@@#%@@%%%%%%########**@@@@@@@@@@@@\n\n\n" +
                    "\nBrave - Let´s continue then\nWe will reset your Helps to 3\nYou are now in Gollum´s Room\n\n\n" +
                            "Are you good with riddles? (I trust in you, write yes to continue!)\n\n"
            );

            prompt.getUserInput(stringInputScannerGollum);

            ////////////////////////////////INSIDE NEW ROOM///////////////////////////////

            question.riddle1();
            engine.broadcast("\n" + player + " from " + team + " pass the 1 riddle", this);

            question.riddle2();
            engine.broadcast("\n" + player + " from " + team + " pass the 2 riddle", this);

            question.riddle3();
            engine.broadcast("\n" + player + " from " + team + " pass the 3 riddle", this);

            question.riddle4();
            engine.broadcast("\n" + player + " from " + team + " pass the 4 riddle", this);

            question.riddle5();
            engine.broadcast("\n" + player + " from " + team + " pass the final riddle and can now enter the final room", this);

            ////////////////////////////////ENTERING FINAL ROOM///////////////////////////////

            String[] options2 = {"Yes", "No"};
            MenuInputScanner menu2 = new MenuInputScanner(options2);
            menu2.setMessage("\nNow you prove that you are able to think\nLet´s see how you handle the final room\nAre you sure you can escape?\n");

            String answer2 = options2[prompt.getUserInput(menu2) - 1];

            if (answer2.equals("No")) {
                engine.broadcast("\n" + player + " from " + team + " has left the game\n", this);
                out.close();
                socket.close();
            }
            out.println("\nLet´s test if you are a real Tolkien fan\nWe will reset again your Helps to 3, you will need!\nYou are now in Silmarillion room\n");
            Question.counter = 3;

            ////////////////////////////////INSIDE NEW ROOM///////////////////////////////

            question.question6();
            engine.broadcast("\n" + player + " from " + team + " pass the 6 question", this);

            question.question7();
            engine.broadcast("\n" + player + " from " + team + " pass the 7 question", this);

            question.question8();
            engine.broadcast("\n" + player + " from " + team + " pass the 8 question", this);

            question.question9();
            engine.broadcast("\n" + player + " from " + team + " pass the 9 question", this);

            question.question10();


            ////////////////////////////////COMPLETED///////////////////////////////

            out.println("\nWell done you complete this Escape Room\n");
            engine.broadcast("\n" + player + " from " + team + " manage to complete the Escape Room\n", this);

            StringInputScanner stringInputScannerfinal = new StringInputScanner();

            stringInputScannerfinal.setMessage("                                                                                          \n" +
                    "                                                                                          \n" +
                    "                                                                                          \n" +
                    "                      .:-:.                                                               \n" +
                    "                         -=-:.                                   .                        \n" +
                    "                          :++-:.                                ..                        \n" +
                    "                           .+++--:                           :--.                         \n" +
                    "                             +**+--:     --:               -==:.                          \n" +
                    "                              +**+==-   .+=*=            :=+=:.                           \n" +
                    "                .::            =#**===. .+++*+         :+++=-.                            \n" +
                    "                  .-=-:         =##*+===*=-=**+       =+*+=-.                             \n" +
                    "                     .-+=:       =%#*+=#*=-:=**-    .++++=-.   --.                        \n" +
                    "                       .-+*=.     +%%**##==-:+**.  .=+++=:. -**:                          \n" +
                    "                          :+*+:    *%%###+=-::=*- :+++==-.=%%+       :                    \n" +
                    "                   ..       -*#*-.  #%###+==-:-++:+++==-+%@#:   .::..                     \n" +
                    "                     :--::.   =####*+%%%%*+=--:=*+++==-*%%#: :-==-.                       \n" +
                    "                       .:===-: :*#%##%%%%#*=--:-*++=++++%*=-==+-.                         \n" +
                    "                          .-+++=-+%%##%%%%#+=-::*+*##+=:*+===-.                           \n" +
                    "                          ::-+++++*#%%%%%%#*+--:*##*+=--====:                             \n" +
                    "                           :=+++++++*%%%%%##+==###*+=--===-      .....                    \n" +
                    "                      .      :-=---=+*#%%%%#*+#%##*+=:--===+++---:.                       \n" +
                    "                       .:---:   :+++===+#%%#*#%##*++-=*#**+=--:.                          \n" +
                    "                           :-*+-. =##*++-:-+#%###***###*++-=**=:  .                       \n" +
                    "                       ...::..-*%#+=%%#**=--=+#*##%%%#**=-*+=-====-:                      \n" +
                    "                           :-++=-==%%@@%%#*+--+****+-++==####*-.                          \n" +
                    "                        ..    .:=+++*#%@@@%#*##**+---+**##*=:.::--::.                     \n" +
                    "                           .:-=+=--*#+--:-=*%%%#*+==****+**++=-::.   .                    \n" +
                    "                          ...:::=#@#@%+===--=####%%##*+=*++----:::.                       \n" +
                    "                              .-++#%@@@%##+++===+*#******+---::::..                       \n" +
                    "                             ..:-===++#%@%@@%#*=-=+##*+++++=:.                            \n" +
                    "                             ...:-=#%%%#+****####%%*+=+*=-::.                             \n" +
                    "                                 ..-*%@@%#*++**#**+***+==::--                             \n" +
                    "                                   .-+##%%%@@%##*++#*+--.                                 \n" +
                    "                                  .--*%@@@#%##%%%#****+                                   \n" +
                    "                                  .==##+*%%@%#*+-*#*=**+-==:                              \n" +
                    "                             .-===+**=-:-==*+==+*+=+*+*=-+===::                           \n" +
                    "                            =**++-+++*=*+++=-:--=-##=:--==---+=:.                         \n" +
                    "                          .+*#*+*#++*=:===++::-*+==*=:::.--=++==-.                        \n" +
                    "                         .=++###%#*#+*--=+=+=*+-=-:-+*-:--++-==-:=.                       \n" +
                    "                         -+#*#*+-+*#+=-=+*#+=*+===.---+#+*+----=-++                       \n" +
                    "                        :*#*##=+*****#**=-=--+**---::*++*+=+-:=--+=                       \n" +
                    "                        -=+*###**%+#****==--===**#*#+*-:--.-+=***==.                      \n" +
                    "                        +++*#%%%%#=:-++*+----+*##+==+*-:-==-=+=-=--.                      \n" +
                    "                       -*##%+%#%#++==+++*#*#+#=-=:.-=+*+=***++=:--+=                      \n" +
                    "                       -*#%#==+##***=+*****=+#+--:====+#*--=:-==:-*=.                     \n" +
                    "                       :#*%++=+*#%####*+-:::+=#++++%+**#+==+--++*+==.                     \n" +
                    "                      .=+*%##*#%#*+**#*=-=**==+=#=-=:-=+#+--:=+*+=--.                     \n" +
                    "                     .-+*##%%%#*+--=#+%*++###++#*=-+=--+*##***+=--+=-.                    \n" +
                    "                      -*#%%++#%*+*#*=+#*#*--===+#*=::::=+**++*=-+-=+=.                    \n" +
                    "                      :+%*++*###**#%*#*##*==::-++#**+**#=--::=#=--+--                     \n" +
                    "                      :***=#*+##%%*+-++*##+=-===+#*=+*+*=----=***++=-                     \n" +
                    "                      .+#*+*%%%%#+==--=*+#**+++#*==-:-+#++---*+====:::                    \n" +
                    "                      .+*##%+*+*%#*==--=*##++***+==:-:-=#++++++=+:===.                    \n" +
                    "                      .**%%*+++*###**+*##+=:--+**======+++++++---===:                     \n" +
                    "                       :+*+%*+-+*#%%*###*+-:--+**+++=***=-::-*=-=++==                     \n" +
                    "                        ++*##***%#+=+=***==-==++****++====--=++==+=-:.                    \n" +
                    "                        -+++#%##%*++.=*+#+*=+*#*++==++*+=-==-++=--==:                     \n" +
                    "                         =+*#+*+*+++=+++*+*+***+==:-==+++=+++=-=+--=                      \n" +
                    "                          =**=+=*#*+==**+**++*+++=+==++*+=+==+=-+--:                      \n" +
                    "                          .**+=+*+##*##+=+=+*##++*+=+++*=+=-+++==-:.                      \n" +
                    "                            =+*=+=**%#+++=++***+***++++=++===+==-.                        \n" +
                    "                             -++==**#*+++==+=*+***++++*+=+-====-.                         \n" +
                    "                              .-==++***+++++++=*+*=+++=-+=-*=-.                           \n" +
                    "                                 .-++===**#+*+-:=*+*+-+#++:-:.                            \n" +
                    "                                       ..         ::...                                   \n" +
                    "                                                                                          \n" +
                    "                                                                                          \n\n\n" +
                    "Enjoy your trophy!!! A beautiful PINEAPPLE!");

            prompt.getUserInput(stringInputScannerfinal);

            out.close();
            socket.close();

        } catch (IOException e) {
            System.out.println("ERROR RUN " + e);
        }
    }


    public Socket getSocket() {
        return socket;
    }
}


